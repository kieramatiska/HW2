---
title: "Untitled"
author: "Kiera Matiska"
date: "1/31/2022"
output: html_document
---

# Overview:


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# attach packages
library(tidyverse)
library(here)
library(GGally)
library(AICcmodavg)
library(broom)
library(caret)
library(jtools)
library(kableExtra)
```

## Read in Data

```{r}
palmetto <- read_csv("palmetto.csv")
```

## Wrangle and Visualize Data {.tabset .tabset-fade}

Create a new data set with the species name in replace of 1 and 2 in species column

```{r}
palmetto_species <- palmetto %>% 
  mutate(species = case_when(
    species == "1" ~ "Serenoa repens",
    species == "2" ~ "Sabal etonia"
  ))
```

Use `ggpairs` to compare data

```{r, include = FALSE}
palmetto_species %>% 
  select(species, height:green_lvs) %>% 
  ggpairs(aes(color = species))
```

Create a subset with only:

- species
- height
- canopy length
- canopy width
- green leaves

```{r}
palmetto_subset <- palmetto_species %>% 
  select(species, height:green_lvs) %>% 
  drop_na()
```

### Plot 1

```{r, include = FALSE}
# wrangle data
palmetto_sum1 <- palmetto_subset %>% 
  group_by(species) %>% 
  summarize(max_height = max(height),
            min_height = min(height),
            mean_height = mean(height),
            sd_height = sd(height),
            species_count = n())
```

```{r}
ggplot(data = palmetto_subset,
       aes(x = height)) +
  geom_histogram(bins = 20, fill = "darkolivegreen4", color = "darkolivegreen") +
  facet_wrap(~ species) +
  labs(title = "Number of Individuals of Each\nPalmetto Species at Different Heights",
       x = "Height (cm)",
       y = "Number of Individuals") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.background = element_rect(fill = "aliceblue"))
```

**Figure 1.** Number of Individuals of Each Palmetto Species at Different Heights. The population count of *Sabal etonia* (species 1) and *Serenoa repens* (species 2) is `r palmetto_sum1$species_count[1]` and `r palmetto_sum1$species_count[2]`, respectively. Species 1 has a maximum height at `r palmetto_sum1$max_height[1]` cm, and minimum height at `r palmetto_sum1$min_height[1]` cm, and a mean height at `r palmetto_sum1$mean_height[1]` cm. Species 2 has a maximum height at `r palmetto_sum1$max_height[2]` cm, and minimum height at `r palmetto_sum1$min_height[2]` cm, and a mean height at `r palmetto_sum1$mean_height[2]` cm. For both species 1 and species 2, they have a standard deviation of `r palmetto_sum1$sd_height[1]` and `r palmetto_sum1$sd_height[2]`, respectively.

### Plot 2

```{r, include = FALSE}
# wrangle data
palmetto_sum2 <- palmetto_subset %>% 
  group_by(species) %>% 
  summarize(max_leaves = max(green_lvs),
            min_leaves = min(green_lvs),
            median_leaves = median(green_lvs),
            mean_leaves = mean(green_lvs),
            count = n())

summary(palmetto_sum2)

```

```{r}
ggplot(data = palmetto_subset,
       aes(x = species, y = green_lvs)) +
  geom_boxplot(color = "black") +
  labs(title = "Number of Green Leaves \nBetween Two Palmetto Species",
       x = "Species",
       y = "Count of Green Leaves") +
  theme_gray() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.background = element_rect(fill = "aliceblue"))
```

**Figure 2.** Number of Green Leaves Between Two Palmetto Species. The number of individuals of *Sabal etonia* (species 1) and *Seriona repens* (species 2) is `r palmetto_sum2$count[1]` and `r palmetto_sum2$count[1]`, respectively. Species 1 has four outliers and species 2 has 8 outliers. For species 1, the maximum number of leaves an individual has is `r palmetto_sum2$max_leaves[1]`, the minimum number of leaves an individual has is `r palmetto_sum2$min_leaves[1]`, and the median number of leaves for all of the individuals is `r palmetto_sum2$median_leaves[1]`. This first quantile of species 1 is 3 leaves per individual and the third quantile is 5 leaves per individual. For species 2, the maximum number of leaves an individual has is `r palmetto_sum2$max_leaves[2]`, the minimum number of leaves an individual has is `r palmetto_sum2$min_leaves[2]`, and the median number of leaves for all of the individuals is `r palmetto_sum2$median_leaves[2]`. This first quantile of species 2 is 3 leaves per individual and the third quantile is 9 leaves per individual.

### Plot 3

```{r}
ggplot(data = palmetto_subset,
       aes(x = length, y = width)) +
  geom_point(aes(color = green_lvs),
             size = 0.3) +
  facet_wrap(~ species) +
  scale_color_gradient(low = "green", high = "yellow") +
  labs(title = "Width of Individual Palmetto Species and\ntheir Green Leave Count Based on Length",
       x = "Length(cm)",
       y = "Width (cm)") +
  theme(plot.title = element_text(hjust = 0.5),
        plot.background = element_rect(fill = "aliceblue"))
```

**Figure 3.** Width of Individual Palmetto Species and their Green Leave Count Based on Length. Width is measured in centimeters and is a function of the length of an individual, also in centimeters. Number of green leaves is also graphed based on both length and width, with `r palmetto_sum2$max_leaves[2]` being the maximum number of leaves and `r palmetto_sum2$min_leaves[1]` being the smallest number of leaves on an individual.

## Conclusion

Based on these graphs, it looks like length, width, and green leaves will be good predictor variables for the determination of which species the palmetto is.

## Binary Linear Regression Model

Create a bnary linear regression model subset

```{r}
palmetto_blr_subset <- palmetto_subset %>% 
  mutate(species = fct_drop(species)) %>% 
  drop_na()
```

```{r}
# levels: 1. Sabal etonia, 2. Serenow repens

f1 <- species ~ height + length + width + green_lvs
f2 <- species ~ height + width + green_lvs

palm_species_blr1 <- glm(formula = f1,
                         data = palmetto_blr_subset,
                         family = "binomial")
palm_species_blr2 <- glm(formula = f2,
                         data = palmetto_blr_subset,
                         family = "binomial")

# palm_species_blr1
# palm_species_blr2

# summary(palm_species_blr1)
# summary(palm_species_blr2)
```

Find AIC values

```{r}
AICc(palm_species_blr1) # 5194.57
AICc(palm_species_blr2) # 5987.48

aictab(list(palm_species_blr1, palm_species_blr2)) # Delta AIC: 792.91
```

Based on this currently, model 1 is the best model not only because it has the lowest AIC value, but the p-values all show significance among all the variables, whereas only t of the 3 variables for model 2.

### Model Selection

Use `caret` package to automate cross validation

```{r}
set.seed(123)

tr_ctrl <- trainControl(method = "repeatedcv", number = 10, repeats = 10)

# train the model
model1 <- train(f1, data = palmetto_blr_subset,
                method = "glm", family = "binomial",
                trControl = tr_ctrl)
model1

model2 <- train(f2, data = palmetto_blr_subset,
                method = "glm", family = "binomial",
                trControl = tr_ctrl)

model2
```

```{r}
final_palmetto_model <- glm(formula = f1, 
                            data = palmetto_blr_subset,
                            family = "binomial")

summary_final <- summary(final_palmetto_model)

final_fitted <- final_palmetto_model %>% 
  broom::augment(type.predict = "response")

final_fitted_odds <- final_fitted %>% 
  select(species:.fitted) %>% 
  mutate(.fitted = .fitted * 100) %>% 
  mutate(suspected_species = case_when(
    .fitted >= 50 ~ "Seronoa repens",
    .fitted < 50 ~ "Sabal etonia"
  ))

model_correct <- final_fitted_odds %>% 
  if(species == suspected_species) {
  n() + 1
} else {
  n() + 1
}

final_palm_tidy <- broom::tidy(final_palmetto_model) %>% 
  mutate(term = case_when(
    term == "(Intercept)" ~ "Intercept",
    term == "height" ~ "Height",
    term == "length" ~ "Length",
    term == "width" ~ "Width",
    term == "green_lvs" ~ "Green Leaves"
  ))

final_palm_tidy %>% 
  kable(caption = "Table 1: Binary Linear Regression Results for Model 1",
      col.names = "Coefficient",
      "Estimate",
      "Standard Error",
      "Statistic",
      "P Value",
      digits = c(0, 2, 3, 4))
```










